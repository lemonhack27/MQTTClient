# 设备树下的platform的led驱动
## 修改文件
* 1、修改pinctrl文件，并且检查引脚是否被占用
* 2、修改设备树文件，并且检查引脚是否被占用(注意头文件之类的)
## 驱动程序编写
__1、驱动加载和驱动卸载函数__
驱动加载和驱动卸载函数。

__2、设备结构体__
* 1、设备号
* 2、cdev结构体，用于描述字符设备
* 3、类
* 4、设备
* 5、设备节点
* 6、自定义数据

__3、设备操作函数__
* 设备操作函数主要是指**file_operations**，一般情况有owner，open，read，write，release等函数，这对应应用程序调用的open，read，write等函数。

__4、platform驱动结构体__
* 1、dirver
此成员内包括name、of_match_table两个成员，其中name成员变量是用于无设备树情况下匹配设备，of_match_table成员变量用于有设备树情况下匹配设备。
of_match_table即匹配列表，主要起作用的是内部的compatible属性，使用字符串匹配方法，与设备树里面的compatible相匹配。

* 2、probe
当驱动与设备匹配成功后就执行此函数。当设备创建时和驱动注册时都会尝试执行此函数。

** 1、初始化设备，主要为了获取节点，同时申请设备树节点所需要的gpio

** 2、申请并注册设备号

** 3、初始化cdev，主要是将cdev与设备操作函数关联起来。

** 4、添加cdev，该函数向内核注册一个struct cdev结构，即正式通知内核cdev所代表的字符设备可以被使用。

** 5、创建类

** 6、创建设备

* 3、remove
设备注销和驱动注销时都会尝试允许此函数。此函数主要是按照创建的逆序执行销毁函数